language: cpp
cache:
  directories:
    - $TRAVIS_BUILD_DIR/src/
matrix:
  include:
  - os: linux
    dist: bionic
    before_install:
    - sudo apt-get update -qq
    - sudo apt-get install devscripts build-essential lintian dh-make
    - sudo apt-get install qt5-default libqt5quick5 libqt5qml5 qtdeclarative5-dev libqt5x11extras5-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libgstreamer-plugins-good1.0-dev libgstreamer-plugins-bad1.0-dev gstreamer1.0-gl gstreamer1.0-libav gstreamer1.0-qt5 libqt5concurrent5 qml-module-qt-labs-settings qml-module-qtquick-controls2 qml-module-qtquick-layouts qml-module-qtquick-controls qml-module-qtquick-shapes qml-module-qtlocation qml-module-qtpositioning qml-module-qtquick-dialogs 
    - sudo apt-get install libgstreamer1.0-0 libgstreamer1.0-dev gstreamer1.0-gl gstreamer1.0-alsa gstreamer1.0-plugins-base libgstreamer-plugins-base1.0-dev gstreamer1.0-plugins-good libgstreamer-plugins-good1.0-dev
    compiler:
    - gcc
    script:
    - echo $TRAVIS_TAG
    - qmake QOpenHD.pro CONFIG+=release
    - make
  - os: osx
    osx_image:  xcode11.2
    before_install:
    - brew install qt5
    - brew link qt5 --force
    - mkdir -p src
    - if ! [ -f ./src/gstreamer-1.0-1.14.4-x86_64.pkg ]; then travis_wait curl -v -o ./src/gstreamer-1.0-1.14.4-x86_64.pkg https://gstreamer.freedesktop.org/data/pkg/osx/1.14.4/gstreamer-1.0-1.14.4-x86_64.pkg; fi
    - if ! [ -f ./src/gstreamer-1.0-devel-1.14.4-x86_64.pkg ]; then travis_wait curl -v -o ./src/gstreamer-1.0-devel-1.14.4-x86_64.pkg https://gstreamer.freedesktop.org/data/pkg/osx/1.14.4/gstreamer-1.0-devel-1.14.4-x86_64.pkg; fi
    - echo "Cached source dir:"
    - ls -l ./src/
    - echo "Installing GStreamer"
    - sudo installer -package ./src/gstreamer-1.0-1.14.4-x86_64.pkg -target /
    - sudo installer -package ./src/gstreamer-1.0-devel-1.14.4-x86_64.pkg -target /
    script:
    - qmake QOpenHD.pro CONFIG+=release
    - make -j5
  - os: windows
    before_install:
    - dir C:/Program\ Files\ \(x86\)/Windows\ Kits/10/bin/10.0.17134.0/x64
    - cmd.exe /C 'cd && "C:\Program Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvarsall.bat"
      x86 && cd && cd "C:/Users/travis/build/infincia/QOpenHD" && dir'
    - if ! [ -f ./src/qt-unified-windows-x86-online.exe ]; then  curl -v -o ./src/qt-unified-windows-x86-online.exe -Lv http://download.qt.io/official_releases/online_installers/qt-unified-windows-x86-online.exe; fi
    - "./src/qt-unified-windows-x86-online.exe --verbose --script qt-installer-windows.qs"
    - ls -la C:/Qt/5.13.1/msvc2017/bin/qtenv2.bat
    script:
    - cmd.exe /C 'cd && "C:\Qt\5.13.1\msvc2017\bin\qtenv2.bat" && cd && "C:\Program
      Files (x86)\Microsoft Visual Studio\2017\BuildTools\VC\Auxiliary\Build\vcvarsall.bat"
      x86 && cd "C:\Users\travis\build\infincia\QOpenHD" && cd && qmake QOpenHD.pro
      && nmake'

